<html>
	<head>
		<title>Picture Helper with JavaScript SDK Example</title>
		<style type="text/css">
			#logo { height: 150px; width: 200px; overflow: hidden; }
		</style>		
	</head>
	<body>		
		<script src="http://tioborracho.github.com/mercadolibre.js/mercadolibre.js" charset="utf-8" ></script>
		<table>
			<tr>
				<td>Item id</td>
				<td><input type="text" id="itemId"></td>
			</tr>
			<form id="pictureForm" method="post" enctype="multipart/form-data" /> 
			<tr>
				<td>Picture</td>
				<td><input type="file" name="file"></td>
			</tr>
			</form>
			<tr>
				<td>Result</td>
				<td><div id="result"></div></td>
			</tr>			
		</table> 	
		<input type="button" value="Add picture" onClick="uploadPicture();"/>

		<script src="http://chico-ui.com.ar/src/js/jquery.js"></script>
		<script src="http://malsup.github.com/jquery.form.js"></script>
		<script type="text/javascript">
		function updateItem(responseJSON){
			var pictureId = responseJSON.id;
			var itemId=document.getElementById("itemId").value
			
			//Add picture to item
			MELI.post("/items/"+itemId+"/pictures/",
				{
					id: pictureId
				},
				function(data){
					if(data[0] == 200){
						$("#result").html("Item successfully modified, new picture id: "+pictureId+". In a few moments it will be available at: <a href='"+data[2].permalink+"'>"+data[2].permalink+"</a>");
					} else {
						$("#result").text("Error updating item: "+data[2].error);
					}
				}
			);
		}

		function uploadPicture(){
			$("#result").text("Processing Request ..."); 
    			//Init the MeLi SDK with test client_id
			MELI.init({client_id: 5736});
				
			//Check the login status
			MELI.getLoginStatus(function(status) {				
				if(!status || !(status.state == "AUTHORIZED" || status.state == "IDENTIFIED")){
					//Login user and get data
					MELI.login();
				}
				
				$('#pictureForm').ajaxSubmit({ 
					success:       updateItem,  // post-submit callback
					dataType: "json",
					url: "https://api.mercadolibre.com/pictures?access_token="+MELI.getToken()
				});

			});			
		}
		</script>
	</body>
</html>
